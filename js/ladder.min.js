class Line{constructor(t,e,i){this.x=t,this.fromY=e,this.toY=i}}const AnimationType=Object.freeze({none:"none",proceeding:"proceeding",complete:"complete"});class Game{#a;#b=[];#c=[];#d=[];#e=[];#f=0;isStart=!1;constructor(t){this.#a=new Canvas(t),this.#a.setDelegate({users:(function(){return this.#b}).bind(this),products:(function(){return this.#c}).bind(this),lines:(function(){return this.#d}).bind(this),connectLines:(function(){return this.#e}).bind(this)})}getResults(){let t=[];for(let e=0;e<this.#b.length;e++){let i=this.#b[e],n=this.#c[i.destinationIndex];t.push({username:i.text,userIndex:e,productName:n.text,productIndex:i.destinationIndex,isWinning:n.isWinning})}return t}destory(){this.#g(),this.#h(),this.#i(),this.#j(),this.isStart&&this.#a.destory(),this.#a=void 0,this.#b=void 0,this.#c=void 0,this.#d=void 0,this.#e=void 0}clearCanvas(){!1!=this.isStart&&this.#a.clearAll()}clearCanvasUsers(){!1!=this.isStart&&this.#a.clearUsers()}clearCanvasProducts(){!1!=this.isStart&&this.#a.clearProducts()}clearCanvasLines(){!1!=this.isStart&&this.#a.clearLines()}clearCanvasConnectLines(){!1!=this.isStart&&this.#a.clearConnectLines()}drawCanvas(){!1!=this.isStart&&(this.#a.clearAll(),this.#a.draw())}drawCanvasUsers(){!1!=this.isStart&&(this.#a.clearUsers(),this.#a.drawUsers())}drawCanvasProducts(){!1!=this.isStart&&(this.#a.clearProducts(),this.#a.drawProducts())}start(t,e,i){this.#f=t,this.#b=this.#k(e,function(t){return new User(t)}),this.#c=this.#k(i,function(t){return new Product(t)}),this.#c=this.#l(this.#b.length,this.#c),this.#m(),this.isStart=!0}redraw(){!1!=this.isStart&&(this.clearCanvas(),this.#m())}userAnimation(t){this.#a.startUserAnimation(void 0,AnimationRoute.interaction,t)}productAnimation(t){this.#a.startProductAnimation(void 0,AnimationRoute.interaction,t)}#m(){let t=CalculatorData.searchOptimalFontSize(this.#b,this.#c,Config.text.baseFontSize);this.#n(function(e){e.fontSize=`${t}${Config.text.fontSuffix}`,e.textSize=Utils.getSize(e.text)}),this.#b=CalculatorData.multilineText(this.#b),this.#c=CalculatorData.multilineText(this.#c);let e=this.#b.map(function(t){return t.reduceMultilineHeightWidthSpacing()}).sort(Utils.numberSortFn)[this.#b.length-1],i=this.#c.map(function(t){return t.reduceMultilineHeightWidthSpacing()}).sort(Utils.numberSortFn)[this.#c.length-1],n=parseFloat(Config.content.margin.left),s=parseFloat(Config.content.margin.top);CalculatorData.makeItems(!0,this.#b,this.#c,n,s,e),this.#a.setSize(new Size(this.#o(),this.#f));let o=this.#a.getSize().height-i-2*Config.text.verticalPadding-parseFloat(Config.content.margin.bottom);CalculatorData.makeItems(!1,this.#b,this.#c,n,o,i),this.#d=CalculatorData.makeLines(this.#b,this.#c),this.#e=CalculatorData.makeConnectLines(this.#d),this.#p(),this.#a.draw()}#k(a,r){if(void 0!=a&&0!=a.length&&!(a[0]instanceof Item)){let c=[];for(let l=0;l<a.length;l++)c.push(r(""+a[l]));a=c}return a}#l(h,u){for(let d=0;d<this.#c.length;d++)this.#c[d].isWinning=!0;for(let m=u.length;m<h;m++){let f=new Product(Config.text.loseText);f.isWinning=!1,u.push(f)}return u=Utils.shuffle(u)}#n(v){for(let g=0;g<this.#b.length;g++)v(this.#b[g]);for(let p=0;p<this.#c.length;p++)v(this.#c[p])}#p(){let $=JSON.stringify(this.#e);for(let x=0;x<this.#b.length;x++){let y=this.#b[x],C=JSON.parse($),_=this.#q(x,C,y.frame.y+y.frame.height+1),w=Math.floor(Math.random()*Object.keys(ColorTypes).length),A=ColorTypes[Object.keys(ColorTypes)[w]];this.#b[x].color=A,this.#b[x].destinationIndex=_,this.#c[_].color=A,this.#c[_].destinationIndex=x}}#q(L,b,I){let P=this.#b[L],S=CalculatorData.selectConnectLineData(!0,b,P.frame.x,P.frame.width,I),T=S.connectLine;if(void 0==T)return L;if(b.splice(S.index,1),S.isAdvance){let z=T.toX<T.fromX?L+1:L-1;return this.#q(z,b,T.y)}{let D=T.toX>T.fromX?L+1:L-1;return this.#q(D,b,T.y)}}#o(){if(0==this.#b.length)return 0;let E=this.#b[this.#b.length-1];return E.frame.x+E.frame.width+parseFloat(Config.content.margin.right)+1}#g(){this.#b=[]}#h(){this.#c=[]}#i(){this.#d=[]}#j(){this.#e=[]}}class Rect{constructor(t,e,i,n){this.x=parseFloat(t),this.y=parseFloat(e),this.width=parseFloat(i),this.height=parseFloat(n)}}class Size{constructor(t,e){this.width=parseFloat(t),this.height=parseFloat(e)}}class CanvasDraw{#r;constructor(t){this.#r=t}destory(){this.#r=void 0}drawRect(t,e){this.#r.lineWidth=parseFloat(Config.item.size),this.#r.strokeStyle=e,this.#r.beginPath(),this.#r.strokeRect(t.x,t.y,t.width,t.height),this.#r.closePath()}drawText(t,e,i,n,s){this.#r.direction="ltr",this.#r.textAlign="left",this.#r.textBaseline="top",this.#r.font=n,this.#r.fillStyle=s,this.#r.beginPath(),this.#r.fillText(t,e,i),this.#r.closePath()}drawLine(t,e,i,n,s,o){this.#r.lineWidth=parseFloat(s),this.#r.strokeStyle=o,this.#r.beginPath(),this.#r.moveTo(t,e),this.#r.lineTo(i,n),this.#r.closePath(),this.#r.stroke()}fillRect(t,e){this.#r.fillStyle=t,this.#r.beginPath(),this.#r.fillRect(e.x,e.y,e.width,e.height),this.#r.closePath()}clearRect(t){this.#r.clearRect(t.x,t.y,t.width,t.height)}}class ConnectLine{constructor(t,e,i){this.fromX=t,this.toX=e,this.y=i}}class Config{static canvas={maxWidth:parseFloat(16e3)};static content={margin:{top:0,bottom:0,left:0,right:0}};static item={size:1,color:"rgba(0, 0, 0, 1)",horizontalSpacing:4};static text={color:"rgba(0, 0, 0, 1)",oneLineMaxWidth:16,maxNumberOfLines:4,baseFontSize:18,fontSuffix:"px serif",loseText:"꽝",lineSpacing:1,verticalPadding:8,horizontalPadding:4};static line={size:1,color:"rgba(0, 0, 0, 1)"};static connectLine={size:1,color:"rgba(0, 0, 0, 1)",verticalMargin:10,minCount:1,maxCount:2};static animation={line:{size:8,colorOpacity:.7,repeatCount:10,repeatDelay:.01},item:{colorOpacity:.3,repeatCount:20,repeatDelay:.001}}}class Item{constructor(t){this.text=t,this.fontSize="",this.textSize=new Size(0,0),this.frame=new Rect(0,0,0,0),this.multilines=[],this.destinationIndex=void 0,this.color=void 0,this.animationType=void 0}reduceMultilineHeight(){return this.multilines.map(function(t){return t.size.height}).reduce(function(t,e,i){return t+e})}reduceMultilineHeightWidthSpacing(){let t=(this.multilines.length-1)*Config.text.lineSpacing;return this.multilines.map(function(t){return t.size.height}).reduce(function(t,e,i){return t+e})+t}longerMultilineWidth(){return this.multilines.map(function(t){return t.size.width}).sort(Utils.numberSortFn)[this.multilines.length-1]}}class User extends Item{}class Product extends Item{isWinning}class Canvas{#s;#a;#t;#u;#v;#w;#x;#y;constructor(t){this.#a=document.createElement("canvas"),this.#t=new CanvasDraw(this.#a.getContext("2d")),this.#u=new Animation,document.getElementById(t).append(this.#a),this.#z()}setSize(t){this.#s=t,this.#a.width=this.#s.width,this.#a.height=this.#s.height}getSize(){return this.#s}getFrame(){return new Rect(0,0,this.#s.width,this.#s.height)}setDelegate(t){this.#v=t}destory(){this.#A(),this.clearAll(),this.#t.destory(),this.#a.parentNode.removeChild(this.#a),this.#s=void 0,this.#a=void 0,this.#t=void 0,this.#u=void 0,this.#v=void 0}draw(){this.clearAll(),this.drawUsers(),this.drawProducts(),this.drawLines(),this.drawConnectLines(),this.#u.resetAnimation()}drawUsers(t){let e=this.#v.users();if(void 0==t)for(let i=0;i<e.length;i++)this.drawUsers(i);else{let n=e[t];this.#t.drawRect(n.frame,Config.item.color),this.#B(n)}}drawProducts(t){let e=this.#v.products();if(void 0==t)for(let i=0;i<e.length;i++)this.drawProducts(i);else{let n=e[t];this.#t.drawRect(n.frame,Config.item.color),this.#B(n)}}drawLines(t){let e=this.#v.lines();if(void 0==t)for(let i=0;i<e.length;i++)this.drawLines(i);else{let n=e[t];this.#t.drawLine(n.x,n.toY,n.x,n.fromY,Config.line.size,Config.line.color)}}drawConnectLines(t){let e=this.#v.connectLines();if(void 0==t)for(let i=0;i<e.length;i++)this.drawConnectLines(i);else{let n=e[t];this.#t.drawLine(n.fromX,n.y,n.toX,n.y,Config.connectLine.size,Config.connectLine.color)}}clearUsers(t){let e=this.#v.users();if(0!=e.length){if(void 0==t){let i=e[0],n=e[e.length-1],s=new Rect(i.frame.x,i.frame.y,n.frame.x+n.frame.width,i.frame.height);this.#t.clearRect(s)}else{let o=e[t];this.#t.clearRect(o.frame)}}}clearProducts(t){let e=this.#v.products();if(0!=e.length){if(void 0==t){let i=e[0],n=e[e.length-1],s=new Rect(i.frame.x,i.frame.y,n.frame.x+n.frame.width,i.frame.height);this.#t.clearRect(s)}else{let o=e[t];this.#t.clearRect(o.frame)}}}clearAnimating(){for(let t=0;t<this.#v.users().length;t++)this.#v.users()[t].animationType=AnimationType.none,this.#v.products()[t].animationType=AnimationType.none;this.#u.resetAnimation()}clearAll(){this.#t.clearRect(this.getFrame()),this.clearAnimating()}startUserAnimation(t,e,i){if(void 0==t){let n=this.#v.users(),s=0;for(let o=0;o<n.length;o++)this.startUserAnimation(o,e,function(){(s+=1)==n.length&&i()})}else{let a=this.#v.users(),r=this.#v.products(),c=a[t],l=r[c.destinationIndex];c.animationType=AnimationType.proceeding,l.animationType=AnimationType.proceeding,this.#C(t,e,(function(){let n=JSON.parse(JSON.stringify(this.#v.connectLines()));this.#D(!0,e,t,c.color,n,c.frame.width/2,c.frame.y+c.frame.height+1,(function(t){this.#E(t,e,(function(){c.animationType=AnimationType.complete,l.animationType=AnimationType.complete,void 0!=i&&"function"==typeof i&&i()}).bind(this))}).bind(this))}).bind(this))}}startProductAnimation(t,e,i){if(void 0==t){let n=this.#v.products(),s=0;for(let o=0;o<n.length;o++)this.startUserAnimation(o,e,function(){(s+=1)==n.length&&i()})}else{let a=this.#v.products(),r=this.#v.users(),c=a[t],l=r[c.destinationIndex];c.animationType=AnimationType.proceeding,l.animationType=AnimationType.proceeding,this.#E(t,e,(function(){let n=JSON.parse(JSON.stringify(this.#v.connectLines()));this.#D(!1,e,t,c.color,n,c.frame.width/2,c.frame.y-1,(function(t){this.#C(t,e,(function(){c.animationType=AnimationType.complete,l.animationType=AnimationType.complete,void 0!=i&&"function"==typeof i&&i()}).bind(this))}).bind(this))}).bind(this))}}#z(){this.#w=(function(t){let e=this.#F(t);this.#G(e)}).bind(this),this.#x=(function(t){let e=this.#F(t);this.#H(e)}).bind(this),this.#y=(function(t){this.#I()}).bind(this),this.#a.addEventListener("click",this.#w,!1),this.#a.addEventListener("mousemove",this.#x,!1),this.#a.addEventListener("mouseleave",this.#y,!1)}#A(){void 0!=this.#w&&(this.#a.removeEventListener("click",this.#w,!1),this.#w=void 0),void 0!=this.#x&&(this.#a.removeEventListener("mousemove",this.#x,!1),this.#x=void 0),void 0!=this.#y&&(this.#a.removeEventListener("mouseleave",this.#y,!1),this.#y=void 0)}#B(U){function R(t){return/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/.test(t)}let k=U.reduceMultilineHeightWidthSpacing(),X=(U.frame.height-k)/2;for(let O=0;O<U.multilines.length;O++){let M=U.multilines[O],W=(U.frame.width-M.size.width)/2,F=U.frame.x+W,B=0;for(let Y=O-1;Y>=0;Y--)B+=U.multilines[Y].size.height;let H=B+Config.text.lineSpacing*O,N=R(M.text)?2:0,V=U.frame.y+X+H+N;this.#t.drawText(M.text,F,V,`${U.fontSize}${Config.text.fontSuffix}`,Config.text.color)}}#F(G){let j=this.#a.offsetLeft+this.#a.clientLeft,q=this.#a.offsetTop+this.#a.clientTop,J=G.pageX-j,K=G.pageY-q;return new Point(J,K)}#G(Q){let Z=this.#J(this.#v.users(),Q);if(-1!=Z){this.clearAll(),this.draw(),this.startUserAnimation(Z,AnimationRoute.click);return}let tt=this.#J(this.#v.products(),Q);if(-1!=tt){this.clearAll(),this.draw(),this.startProductAnimation(tt,AnimationRoute.click);return}}#H(te){let ti=this.#J(this.#v.users(),te),tn=this.#J(this.#v.products(),te),ts=this.#v.users(),to=this.#v.products();-1!=ti||-1!=tn?document.body.style.cursor="pointer":document.body.style.cursor="default",this.hoverEventUserIndex!=ti&&(void 0!=this.hoverEventUserIndex&&ts[this.hoverEventUserIndex].animationType==AnimationType.none&&(this.#u.resetAnimation(AnimationRoute.move),this.clearUsers(this.hoverEventUserIndex),this.drawUsers(this.hoverEventUserIndex),this.hoverEventUserIndex=void 0),-1!=ti&&ts[ti].animationType==AnimationType.none&&(this.hoverEventUserIndex=ti,this.#C(ti,AnimationRoute.move))),this.hoverEventProductIndex!=tn&&(void 0!=this.hoverEventProductIndex&&to[this.hoverEventProductIndex].animationType==AnimationType.none&&(this.#u.resetAnimation(AnimationRoute.move),this.clearProducts(this.hoverEventProductIndex),this.drawProducts(this.hoverEventProductIndex),this.hoverEventProductIndex=void 0),-1!=tn&&to[tn].animationType==AnimationType.none&&(this.hoverEventProductIndex=tn,this.#E(tn,AnimationRoute.move)))}#I(){document.body.style.cursor="default";let ta=this.#v.users(),tr=this.#v.products();void 0!=this.hoverEventUserIndex&&ta[this.hoverEventUserIndex].animationType==AnimationType.none&&(this.#u.resetAnimation(AnimationRoute.move),this.clearUsers(this.hoverEventUserIndex),this.drawUsers(this.hoverEventUserIndex),this.hoverEventUserIndex=void 0),void 0!=this.hoverEventProductIndex&&tr[this.hoverEventProductIndex].animationType==AnimationType.none&&(this.#u.resetAnimation(AnimationRoute.move),this.clearProducts(this.hoverEventProductIndex),this.drawProducts(this.hoverEventProductIndex),this.hoverEventProductIndex=void 0)}#J(tc,tl){function th(t,e){return!!(e.frame.x<t.x)&&!!(t.x<e.frame.x+e.frame.width)&&!!(e.frame.y<t.y)&&!!(t.y<e.frame.y+e.frame.height)}for(let tu=0;tu<tc.length;tu++)if(th(tl,tc[tu]))return tu;return -1}#C(td,tm,tf){let tv=this.#v.users()[td],tg=Config.animation.item.repeatCount;this.#u.animationRecursion(tm,tg,Config.animation.item.repeatDelay,(function(t){if(-1==t){void 0!=tf&&tf();return}this.clearUsers(td),this.drawUsers(td);let e=tv.color.value(Config.animation.item.colorOpacity*t/tg);this.#t.fillRect(e,tv.frame)}).bind(this))}#E(tp,t$,tx){let ty=this.#v.products()[tp],tC=Config.animation.item.repeatCount;this.#u.animationRecursion(t$,tC,Config.animation.item.repeatDelay,(function(t){if(-1==t){void 0!=tx&&tx();return}this.clearProducts(tp),this.drawProducts(tp);let e=ty.color.value(Config.animation.item.colorOpacity*t/tC);this.#t.fillRect(e,ty.frame)}).bind(this))}#D(t_,tw,tA,tL,tb,tI,tP,tS){let tT=t_?this.#v.users()[tA]:this.#v.products()[tA],tz=CalculatorData.selectConnectLineData(t_,tb,tT.frame.x,tT.frame.width,tP),t0=tz.connectLine;if(void 0==t0){let tD=t_?this.#v.products()[tA]:this.#v.users()[tA],tE=t_?tD.frame.y:tD.frame.y+tD.frame.height;this.#K(tw,tL,tI,tP,tE,function(){void 0!=tS&&tS(tA)});return}tb.splice(tz.index,1),tz.isAdvance?this.#K(tw,tL,t0.toX,tP,t0.y,(function(){this.#L(tw,tL,t0.toX,t0.fromX,t0.y,(function(){let t=t0.toX<t0.fromX?tA+1:tA-1;this.#D(t_,tw,t,tL,tb,t0.fromX,t0.y,tS)}).bind(this))}).bind(this)):this.#K(tw,tL,t0.fromX,tP,t0.y,(function(){this.#L(tw,tL,t0.fromX,t0.toX,t0.y,(function(){let t=t0.toX>t0.fromX?tA+1:tA-1;this.#D(t_,tw,t,tL,tb,t0.toX,t0.y,tS)}).bind(this))}).bind(this))}#K(tU,tR,tk,tX,tO,t3){let tM=Config.animation.line.repeatCount,tW=(tO-tX)/tM;this.#u.animationRecursion(tU,tM,Config.animation.line.repeatDelay,(function(t){if(-1==t){void 0!=t3&&t3();return}let e=tX+tW*t;this.#t.drawLine(tk,e,tk,e+tW,Config.animation.line.size,tR.value())}).bind(this))}#L(t1,t9,tF,t6,t2,t4){let tB=Config.animation.line.repeatCount,tY=(t6-tF)/tB;this.#u.animationRecursion(t1,tB,Config.animation.line.repeatDelay,(function(t){if(-1==t){void 0!=t4&&t4();return}let e=tF+tY*t;this.#t.drawLine(e,t2,e+tY,t2,Config.animation.line.size,t9.value())}).bind(this))}}class ItemTextLine{constructor(t,e){this.text=t,this.size=e}}class Utils{static random(t,e){return(Math.random()*(e-t)+t).toFixed(3)}static roundRandom(t,e){return Math.round((Math.random()*(e-t)+t).toFixed(3))}static getSize(t,e){let i=document.createElement("canvas"),n=i.getContext("2d");n.font=e;let s=n.measureText(t),o=s.width,a=s.fontBoundingBoxAscent+s.fontBoundingBoxDescent;return s.actualBoundingBoxAscent,s.actualBoundingBoxDescent,new Size(o,a-4)}static shuffle(t){let e=t.length,i;for(;e>0;)i=Math.floor(Math.random()*e),e--,[t[e],t[i]]=[t[i],t[e]];return t}static numberSortFn=(t,e)=>t<e?-1:t===e?0:1}const ColorTypes=Object.freeze({color1:{value:function(t){return"rgba(255,179,186,"+(void 0==t?Config.animation.line.colorOpacity:t)+")"}},color2:{value:function(t){return"rgba(255,223,186,"+(void 0==t?Config.animation.line.colorOpacity:t)+")"}},color3:{value:function(t){return"rgba(255,255,186,"+(void 0==t?Config.animation.line.colorOpacity:t)+")"}},color4:{value:function(t){return"rgba(186,255,201,"+(void 0==t?Config.animation.line.colorOpacity:t)+")"}},color5:{value:function(t){return"rgba(186,225,255,"+(void 0==t?Config.animation.line.colorOpacity:t)+")"}},color6:{value:function(t){return"rgba(255,217,217,"+(void 0==t?Config.animation.line.colorOpacity:t)+")"}},color7:{value:function(t){return"rgba(255,242,204,"+(void 0==t?Config.animation.line.colorOpacity:t)+")"}},color8:{value:function(t){return"rgba(234,209,220,"+(void 0==t?Config.animation.line.colorOpacity:t)+")"}},color9:{value:function(t){return"rgba(252,229,205,"+(void 0==t?Config.animation.line.colorOpacity:t)+")"}},color10:{value:function(t){return"rgba(217,210,233,"+(void 0==t?Config.animation.line.colorOpacity:t)+")"}},color11:{value:function(t){return"rgba(254,229,206,"+(void 0==t?Config.animation.line.colorOpacity:t)+")"}},color12:{value:function(t){return"rgba(213,187,193,"+(void 0==t?Config.animation.line.colorOpacity:t)+")"}},color13:{value:function(t){return"rgba(178,160,180,"+(void 0==t?Config.animation.line.colorOpacity:t)+")"}},color14:{value:function(t){return"rgba(133,123,145,"+(void 0==t?Config.animation.line.colorOpacity:t)+")"}},color15:{value:function(t){return"rgba(90,85,107,"+(void 0==t?Config.animation.line.colorOpacity:t)+")"}}});class Animation{#M=[];resetAnimation(t){this.clearAnimation(t),this.#M=[]}clearAnimation(t){let e="";void 0!=t&&(e=t.prefix());for(var i=0;i<this.#M.length;i++){let n=this.#M[i];n.startsWith(e)&&(Object.values(AnimationRoute).forEach(function(t){n=t.removePrefix(n)}),clearTimeout(n))}}animationRecursion(t,e,i,n){let s=(function(o){if(o==e){n(-1);return}let a=setTimeout(function(){n(o),s(o+1)},1e3*i);this.#M.push(t.combineAnimationID(a))}).bind(this);s(0)}}class Point{constructor(t,e){this.x=parseFloat(t),this.y=parseFloat(e)}}const AnimationRoute=Object.freeze({click:{prefix:function(){return"click"},combineAnimationID:function(t){return`${this.prefix()}_${t}`},removePrefix:function(t){return t.replace(`${this.prefix()}_`,"")}},move:{prefix:function(){return"move"},combineAnimationID:function(t){return`${this.prefix()}_${t}`},removePrefix:function(t){return t.replace(`${this.prefix()}_`,"")}},interaction:{prefix:function(){return"interaction"},combineAnimationID:function(t){return`${this.prefix()}_${t}`},removePrefix:function(t){return t.replace(`${this.prefix()}_`,"")}}});class CalculatorData{static makeItems(t,e,i,n,s,o){let a=n,r=s;for(let c=0;c<e.length;c++){let l=e[c],h=i[c],u=l.longerMultilineWidth(),d=h.longerMultilineWidth(),m=(u>d?u:d)+2*Config.text.horizontalPadding,f=o+2*Config.text.verticalPadding;t?l.frame=new Rect(a,r,m,f):h.frame=new Rect(a,r,m,f),a+=m+parseFloat(Config.item.horizontalSpacing)}}static makeLines(t,e){let i=[];for(let n=0;n<t.length;n++){let s=t[n],o=e[n],a=s.frame.x+s.frame.width/2,r=s.frame.y+s.frame.height,c=o.frame.y;i.push(new Line(a,r,c))}return i}static makeConnectLines(t){let e=parseInt(Config.connectLine.minCount),i=parseInt(Config.connectLine.maxCount),n=[];for(let s=0;s<t.length;s++){let o=t[s];if(s<t.length-1){let a=Utils.roundRandom(e,i),r=t[s+1];for(let c=0;c<a;c++){let l=this.makeRandomLine(n,o.x,o.fromY+parseFloat(Config.connectLine.verticalMargin),r.x,o.toY-parseFloat(Config.connectLine.verticalMargin));if(void 0==l)return this.makeConnectLines(t,e,i);void 0!=l&&n.push(l)}}if(s>0){let h=Utils.roundRandom(e,i),u=t[s-1];for(var d=0;d<h;d++){let m=this.makeRandomLine(n,u.x,o.fromY+parseFloat(Config.connectLine.verticalMargin),o.x,o.toY-parseFloat(Config.connectLine.verticalMargin));if(void 0==m)return this.makeConnectLines(t,e,i);void 0!=m&&n.push(m)}}}return n}static makeRandomLine(t,e,i,n,s){let o=t.filter(function(t,i,s){return t.fromX==e||t.fromX==n||t.toX==e||t.toX==n}).map(function(t){return parseFloat(t.y)}).sort(Utils.numberSortFn),a=(i+s)/2,r=0;if(0<o.length&&(a=(o[0]+i)/2,r=o[0]-i),o.length>1)for(var c=0;c<o.length;c++){let l=o[c];if(c<o.length-1){let h=o[c+1],u=h-l;r<u&&(r=u,a=(h+l)/2)}else{let d=s-l;r<d&&(r=d,a=(l+s)/2)}}return new ConnectLine(e,n,a)}static getMaxWidth(t,e,i){let n=parseFloat(Config.content.margin.left);for(var s=0;s<t.length;s++){let o=Utils.getSize(t[s].text,i).width,a=Utils.getSize(e[s].text,i).width,r;n+=(o>a?o:a)+2*Config.text.horizontalPadding+(s==t.length-1?0:Config.itemSpacing)}return n+=parseFloat(Config.content.margin.right),parseFloat(n)}static searchOptimalFontSize(t,e,i){return i<6?i:Config.canvas.maxWidth<this.getMaxWidth(t,e,`${i}${Config.text.fontSuffix}`)?this.searchOptimalFontSize(t,e,i-.5):i}static multilineText(t){for(let e=0;e<t.length;e++){let i=t[e],n=1;for(let s=Config.text.maxNumberOfLines;s>0;s--)if(i.textSize.width>Config.text.oneLineMaxWidth*s){n=s;break}let o=Math.ceil(i.text.length/n);i.multilines=[];for(let a=0;a<n;a++){let r=o*a,c=a==n-1&&n==Config.text.maxNumberOfLines,l=c?3:0,h=c?"...":"",u=i.text.substr(r,o-l)+h,d=Utils.getSize(u,i.fontSize);i.multilines.push(new ItemTextLine(u,d))}}return t}static selectConnectLineData(t,e,i,n,s){let o,a,r,c;function l(e,l,h,u){let d=void 0==o||(t?o>=e.y:o<=e.y),m=t?s<e.y:s>e.y;d&&m&&h>i-1&&i+n+1>h&&(o=e.y,a=e,c=u,r=l)}for(let h=0;h<e.length;h++){let u=e[h];l(u,h,u.fromX,!1),l(u,h,u.toX,!0)}return{connectLine:a,index:r,isAdvance:c}}}class Load{static onLoad(t){t()}}